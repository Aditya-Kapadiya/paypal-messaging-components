<!DOCTYPE html>

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>

<body>
    <script>
        const query = window.location.search
            .slice(1)
            .split('&')
            .reduce((accumulator, pair) => {
                const [key, val] = pair.split('=');
                accumulator[key] = val;

                return accumulator;
            }, {});
        const amount = Number(query.amount);
        const total = amount * 1.0999;
        const props = {
            terms: query.amount
                ? {
                      type: 'pala',
                      maxAmount: 5000,
                      minAmount: 199,
                      amount,
                      formattedAmount: amount.toFixed(2),
                      offers: [
                          {
                              term: 12,
                              type: 'INST',
                              apr: '9.99',
                              nominalRate: '9.5598',
                              minValue: '199.00',
                              qualified: 199 < amount && amount < 5000,
                              monthly: (total / 12).toFixed(2),
                              total: total.toFixed(2),
                              totalInterest: (total - amount).toFixed(2)
                          }
                      ],
                      formattedMinAmount: '199',
                      formattedMaxAmount: '5,000'
                  }
                : {}
        };

        const script = window.top.document.querySelector('script');

        const interfaceScript = document.createElement('script');
        Array.from(script.attributes).forEach(attr => {
            interfaceScript.setAttribute(attr.name, attr.value);
        });

        const modalScript = document.createElement('script');
        modalScript.src = 'http://localhost.paypal.com:8080/smart-credit-modal.js';

        const initScript = document.createElement('script');
        initScript.textContent = `crc.setupModal(${JSON.stringify(props)})`;

        interfaceScript.onload = () => document.body.appendChild(modalScript);
        modalScript.onload = () => document.body.appendChild(initScript);

        document.body.appendChild(interfaceScript);
    </script>
</body>
